(function(){"use strict";const S=["applovin","albss"],l="_albss_req_",p="_albss_rct_",u={receipt:p,request:l},R=async(e,t)=>{const s=Date.now();await t();const n=Date.now()-s,r=e-n;r>0&&await new Promise(c=>setTimeout(c,r)),R(e,t)},h=e=>new RegExp(`${u[e]}[1-9][0-9]*`),d=e=>Object.keys(localStorage).filter(n=>h(e).test(n)).reduce((n,r)=>{const c=localStorage.getItem(r);return c?{...n,[r]:JSON.parse(c)}:n},{}),a=(e,t)=>d(e)[`${u[e]}${t}`],q=(e,t,s)=>{const n=a(e,t)||[s],c=n.find(o=>o.id===s.id)?n.map(o=>o.id===s.id?s:o):[...n,s];localStorage.setItem(`${u[e]}${t}`,JSON.stringify(c))},O=(e,t,s)=>{const r=(a(e,t)||[]).filter(c=>c.id!==s);localStorage.setItem(`${u[e]}${t}`,JSON.stringify(r))},g=(e,t)=>{Object.keys(e).forEach(s=>{e[s].forEach(n=>{t(s,n)})})},m=(e,t)=>Object.keys(e).reduce((s,n)=>({...s,[n]:e[n].filter(r=>t(n,r))}),{}),f=e=>e.replace(p,""),w=e=>e.replace(l,""),E=e=>{const t=new URL(e);return S.some(s=>t.host.includes(s))},_=async(e,t)=>{const{method:s,url:n,params:r,body:c}=t;if(!E(n)){const o={status:-1,id:t.id};return[e,o]}try{const i={status:s==="GET"?await P(n,r):await $(n,c),id:t.id};return[e,i]}catch{const i={status:400,id:t.id};return[e,i]}},$=(e,t)=>new Promise(s=>{const n=JSON.stringify(t),r=navigator.sendBeacon(e,n);s(r?200:400)}),P=(e,t={})=>new Promise(s=>{const n=new Image;n.onload=()=>{s(200)},n.onerror=()=>{s(400)},n.src=`${e}${t?`?${Q(t)}`:""}`}),Q=e=>Object.entries(e).map(([t,s])=>`${t}=${s}`).join("&"),T=()=>{const e=d("receipt"),t=m(e,(s,n)=>a("request",f(s)).filter(c=>c.id===n.id).length===0);g(t,(s,n)=>{O("receipt",f(s),n.id)})},b=async()=>{const e=d("request"),t=[],s=m(e,(r,c)=>{const o=a("receipt",w(r));return o?o.filter(i=>i.id===c.id&&i.status===200).length===0:!0});return g(s,(r,c)=>{t.push(_(w(r),c))}),await Promise.all(t)};localStorage&&R(3e3,async()=>{T(),(await b()).forEach(([t,s])=>q("receipt",t,s))})})();
